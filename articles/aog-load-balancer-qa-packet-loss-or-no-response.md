---
title: 导致负载均衡器间歇性丢包或负载不均衡的常见因素
description: 导致负载均衡器间歇性丢包或负载不均衡的常见因素
services: Load Balancer
documentationCenter: ''
author: Bingyu83
manager: ''
editor: ''
tags: 'Load Balancer, Packet Loss'

ms.service: load-balancer
wacn.topic: aog
ms.topic: article
ms.author: biyu
ms.date: 08/01/2017
wacn.date: 08/01/2017
---

# 导致负载均衡器间歇性丢包或负载不均衡的常见因素

## 问题描述

在生产环境中，配置了负载均衡策略，但是发现实际服务请求经过负载均衡后，会出现间歇性丢包或是无响应，但是可以确认检查负载均衡工作正常，后端服务器操作系统服务端口侦听也正常。

## 问题分析

本文集中列出可能会导致此问题的原因（操作系统内部的错误配置不在本文讨论范畴）

- 经典模式

    创建虚拟机时，为各个虚拟机自身配置了终结点，并将相同服务端口的终结点加入了负载均衡集，负载均衡集下配置了 ACL 访问控制策略允许特定 IP 访问，之后有一条默认拒绝 0.0.0.0/0 的策略，如果源端是多链路出口 IP 有多个，但是 ACL 里面没有将所有源端 IP 都列入，当源端有未列入允许的 ACL 的 IP 发起请求时，就会被负载均衡集的 ACL 策略阻断。

- 资源管理器模式

    1. 配置了负载均衡器，但是在负载均衡规则中启用了会话保持功能，导致负载均衡器按照会话保持原则针对客户端 IP 或客户端和协议做了会话保持，只要客户端一侧有 keep-alive 机制，并且始终在 keep-alive 时间内有请求流量，客户端的请求会一直被分配到首次接收请求的后端服务器，并没有实现负载均衡。
    2. 后端个别服务器网卡配置了 NSG 拒绝策略（例如 443 端口），但是负载均衡器的运行状况探测配置了其他端口（例如 80 端口）作为负载均衡器检查后端服务器的健康状态的判断依据，结果使得负载均衡器提供探测判断所有后端服务器是健康的，当把流量分配给配置了 NSG 拒绝策略的后端服务器时，来自客户端的请求会被拒绝（例如来自客户端发往服务器 443 端口的请求），但是分配给其他没有 NSG 策略的后端服务器时，就会正常响应，现象就是时而通时而不通。这种问题除了在 WEB 服务器常见外，在 REDIS 服务也会常见，因为它也具有多个不同端口响应（同步端口，服务响应端口，监控状态监控端口等），所以规避此类问题需要准确配置运行状况探测的端口。

